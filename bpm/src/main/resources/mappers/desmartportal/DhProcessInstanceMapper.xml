<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.desmart.desmartportal.dao.DhProcessInstanceMapper">
	
	<resultMap id="ProcessInstanceMap" type="java.util.Map">
		<result column="INS_UID" 						property="insUid"/>
		<result column="INS_TITLE" 						property="insTitle"/>
		<result column="INS_DESCRIPTION" 				property="insDescription"/>
		<result column="INS_ID" 						property="insId"/>
		<result column="INS_PARENT" 					property="insParent"/>
		<result column="INS_STATUS" 					property="insStatus"/>
		<result column="INS_STATUS_ID" 					property="insStatusId"/>
		<result column="PRO_APP_ID" 					property="proAppId"/>
		<result column="PRO_UID" 						property="proUid"/>
		<result column="PRO_VER_UID" 					property="proVerUid"/>
		<result column="INS_INIT_USER" 					property="insInitUser"/>
		<result column="INS_CREATE_DATE" 				property="insCreateDate"/>
		<result column="INS_INIT_DATE" 					property="insInitDate"/>
		<result column="INS_FINISH_DATE" 				property="insFinishDate"/>
		<result column="INS_UPDATE_DATE" 				property="insUpdateDate"/>
		<result column="INS_DATA" 						property="insData"/>
		<result column="INS_DURATION" 					property="insDuration"/>
		<result column="INS_DELAY_DURATION" 			property="insDelayDuration"/>
		<result column="INS_DRIVE_FOLDER_UID" 			property="insDriveFolderUid"/>
		<result column="INS_ROUTING_DATA" 				property="insRoutingData"/>
		<result column="COMPANY_NUMBER" 				property="companyNumber"/>
		<result column="DEPART_NO" 				        property="departNo"/>
	</resultMap>
	
	<sql id="Base_Column_List">
		INS_UID,INS_TITLE,INS_DESCRIPTION,INS_ID,
		INS_PARENT,INS_STATUS,INS_STATUS_ID,PRO_APP_ID,
		PRO_UID,PRO_VER_UID,INS_INIT_USER,INS_CREATE_DATE,
		INS_INIT_DATE,INS_FINISH_DATE,INS_UPDATE_DATE,INS_DATA,
		INS_DURATION,INS_DELAY_DURATION,INS_DRIVE_FOLDER_UID,INS_ROUTING_DATA, COMPANY_NUMBER, DEPART_NO
	</sql>
	
    <sql id="realationColumnList">
        ins.INS_UID,ins.INS_TITLE,ins.INS_DESCRIPTION,ins.INS_ID,
        ins.INS_PARENT,ins.INS_STATUS,ins.INS_STATUS_ID,ins.PRO_APP_ID,
        ins.PRO_UID,ins.PRO_VER_UID,ins.INS_INIT_USER,ins.INS_CREATE_DATE,
        ins.INS_INIT_DATE,ins.INS_FINISH_DATE,ins.INS_UPDATE_DATE,ins.INS_DATA,
        ins.INS_DURATION,ins.INS_DELAY_DURATION,ins.INS_DRIVE_FOLDER_UID,ins.INS_ROUTING_DATA, ins.COMPANY_NUMBER,
        ins.DEPART_NO
    </sql>
	
	<select id="selectAllProcess" parameterType="com.desmart.desmartportal.entity.DhProcessInstance" resultType="com.desmart.desmartportal.entity.DhProcessInstance">
		SELECT 
		<include refid="Base_Column_List"/>
		FROM
		DH_PROCESS_INSTANCE
		<where>
			<if test="insUid != null and insUid != ''">
				INS_UID = #{insUid}
			</if>
			<if test="insTitle != null and insTitle != ''">
				AND INS_TITLE = #{insTitle}
			</if>
			<if test="insDescription != null and insDescription != ''">
				AND INS_DESCRIPTION = #{insDescription}
			</if>
			<if test="insId != null and insId != ''">
				AND INS_ID = #{insId}
			</if>
			<if test="insParent != null and insParent != ''">
				AND INS_PARENT = #{insParent}
			</if>
			<if test="insStatus != null and insStatus != ''">
				AND INS_STATUS = #{insStatus}
			</if>
			<if test="insStatusId != null and insStatusId != ''">
				AND INS_STATUS_ID = #{insStatusId}
			</if>
			<if test="proAppId != null and proAppId != ''">
				AND PRO_APP_ID = #{proAppId}
			</if>
			<if test="proUid != null and proUid != ''">
				AND PRO_UID = #{proUid}
			</if>
			<if test="proVerUid != null and proVerUid != ''">
				AND PRO_VER_UID = #{proVerUid}
			</if>
			<if test="insInitUser != null and insInitUser != ''">
				AND INS_INIT_USER = #{insInitUser}
			</if>
			<if test="insCreateDate != null ">
				AND INS_CREATE_DATE = #{insCreateDate}
			</if>
			<if test="insInitDate != null ">
				AND INS_INIT_DATE = #{insInitDate}
			</if>
			<if test="insFinishDate != null">
				AND INS_FINISH_DATE = #{insFinishDate}
			</if>
			<if test="insUpdateDate != null">
				AND INS_UPDATE_DATE = #{insUpdateDate}
			</if>
			<if test="insData != null and insData != ''">
				AND INS_DATA = #{insData}
			</if>
			<if test="insDuration != null and insDuration != ''">
				AND INS_DURATION = #{insDuration}
			</if>
			<if test="insDelayDuration != null and insDelayDuration != ''">
				AND INS_DELAY_DURATION = #{insDelayDuration}
			</if>
			<if test="insDriveFolderUid != null and insDriveFolderUid != ''">
				AND INS_DRIVE_FOLDER_UID = #{insDriveFolderUid}
			</if>
			<if test="insRoutingData != null and insRoutingData != ''">
				AND INS_ROUTING_DATA = #{insRoutingData}
			</if>
			<if test="companyNumber != null and companyNumber != ''">
				AND COMPANY_NUMBER = #{companyNumber}
			</if>
			<if test="departNo != null and departNo != ''">
				AND DEPART_NO = #{departNo}
			</if>
		</where>
	</select>
	
	<select id="selectByPrimaryKey" parameterType="java.lang.String" resultType="com.desmart.desmartportal.entity.DhProcessInstance">
       SELECT <include refid="realationColumnList"/>, meta.pro_Name
       FROM dh_process_instance ins
       left join dh_process_meta meta
         on ins.pro_App_Id = meta.pro_App_Id and ins.pro_Uid = meta.pro_Uid
       where ins.ins_uid = #{insUid}
	</select>
	
	<update id="updateByPrimaryKeySelective" parameterType="com.desmart.desmartportal.entity.DhProcessInstance">
		UPDATE DH_PROCESS_INSTANCE
		<set>
			<if test="insTitle != null and insTitle != ''">
				INS_TITLE = #{insTitle},
			</if>
			<if test="insDescription != null and insDescription != ''">
				INS_DESCRIPTION = #{insDescription},
			</if>
			<if test="insId != null and insId != ''">
				INS_ID = #{insId},
			</if>
			<if test="insParent != null and insParent != ''">
				INS_PARENT = #{insParent},
			</if>
			<if test="insStatus != null and insStatus != ''">
				INS_STATUS = #{insStatus},
			</if>
			<if test="insStatusId != null and insStatusId != ''">
				INS_STATUS_ID = #{insStatusId},
			</if>
			<if test="proAppId != null and proAppId != ''">
				PRO_APP_ID = #{proAppId},
			</if>
			<if test="proUid != null and proUid != ''">
				PRO_UID = #{proUid},
			</if>
			<if test="proVerUid != null and proVerUid != ''">
				PRO_VER_UID = #{proVerUid},
			</if>
			<if test="insInitUser != null and insInitUser != ''">
				INS_INIT_USER = #{insInitUser},
			</if>
			<if test="insCreateDate != null">
				INS_CREATE_DATE = #{insCreateDate},
			</if>
			<if test="insInitDate != null">
				INS_INIT_DATE = #{insInitDate},
			</if>
			<if test="insFinishDate != null">
				INS_FINISH_DATE = #{insFinishDate},
			</if>
			<if test="insUpdateDate != null">
				INS_UPDATE_DATE = #{insUpdateDate},
			</if>
			<if test="insData != null and insData != ''">
				INS_DATA = #{insData},
			</if>
			<if test="insDuration != null and insDuration != ''">
				INS_DURATION = #{insDuration},
			</if>
			<if test="insDelayDuration != null and insDelayDuration != ''">
				INS_DELAY_DURATION = #{insDelayDuration},
			</if>
			<if test="insDriveFolderUid != null and insDriveFolderUid != ''">
				INS_DRIVE_FOLDER_UID = #{insDriveFolderUid},
			</if>
			<if test="insRoutingData != null and insRoutingData != ''">
				INS_ROUTING_DATA = #{insRoutingData},
			</if>
			<if test="companyNumber != null and companyNumber != ''">
				COMPANY_NUMBER = #{companyNumber},
			</if>
			<if test="departNo != null and departNo != ''">
				DEPART_NO = #{departNo}
			</if>
			<where>
				INS_UID = #{insUid}
			</where>
		</set>
	</update>
	
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		DELETE 
		FROM 
		DH_PROCESS_INSTANCE
		<where>
			INS_UID = #{insUid}
		</where>
	</delete>
	
	<insert id="insertProcess" parameterType="com.desmart.desmartportal.entity.DhProcessInstance">
		INSERT INTO
		DH_PROCESS_INSTANCE
		(<include refid="Base_Column_List"/>)
		VALUES
		(
			#{insUid},
			#{insTitle},
			#{insDescription},
			#{insId},
			#{insParent},
			#{insStatus},
			#{insStatusId},
			#{proAppId},
			#{proUid},
			#{proVerUid},
			#{insInitUser},
			sysdate,
			sysdate,
			#{insFinishDate},
			sysdate,
			#{insData},
			#{insDuration},
			#{insDelayDuration},
			#{insDriveFolderUid},
			#{insRoutingData},
			#{companyNumber},
			#{departNo}
		)
	</insert>
	
    <select id="queryByInsId" parameterType="int" resultType="com.desmart.desmartportal.entity.DhProcessInstance">
       SELECT <include refid="realationColumnList"/>, meta.pro_Name
       FROM dh_process_instance ins
       left join dh_process_meta meta
         on ins.pro_App_Id = meta.pro_App_Id and ins.pro_Uid = meta.pro_Uid
       where ins.ins_id = #{insId}
    </select>
    
    <select id="queryByStausOrTitle" parameterType="java.util.Map" resultType="com.desmart.desmartportal.entity.DhProcessInstance">
    	SELECT
		<include refid="Base_Column_List"/>
		FROM
		DH_PROCESS_INSTANCE
		<where>
			<if test="insUid != null and insUid != ''">
				INS_UID = #{insUid}
			</if>
			<if test="insTitle != null and insTitle != ''">
				AND INS_TITLE like '%' || #{insTitle} || '%'
			</if>
			<if test="insStatusId != null and insStatusId != ''">
				AND INS_STATUS_ID = #{insStatusId}
			</if>
		</where> 
    </select>
	
	<update id="updateBySelective" parameterType="com.desmart.desmartportal.entity.DhProcessInstance">
		update DH_PROCESS_INSTANCE
		<set>
			INS_STATUS = '-1'
		</set>
		<where>
			PRO_UID = #{proUid}
			and PRO_APP_ID = #{proAppId}
		</where>
	</update>
</mapper>